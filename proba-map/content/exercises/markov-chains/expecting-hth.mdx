---
id: "expecting-hth"
title: "Expecting HTH"
difficulty: "Hard"
patterns: ["markov-chains"]
tags:
    [
        "probability",
        "markov-chains",
        "expectation",
        "coin-flips",
        "pattern-matching",
        "absorbing-states",
    ]
---

## Exercise

On average, how many flips of a fair coin (heads or tails) are needed to observe the sequence **HTH** (Heads–Tails–Heads) for the first time?

## Hint

Model the problem as a Markov chain with states representing the progress toward observing HTH. Define states for: nothing seen, H seen, HT seen, and HTH seen (absorbing).

## Hint

Set up a system of equations for the expected hitting times $\mu_i$ from each state $S_i$ to the absorbing state. Use the recursive formula: $\mu_i = 1 + \sum_j p_{ij} \mu_j$.

## Hint

When solving the system, start by expressing $\mu_2$ in terms of $\mu_0$, then substitute into the equation for $\mu_1$, and finally solve for $\mu_0$.

## Solution

**Markov chain**

We model the appearance of HTH using the following chain:

- $S_0$: nothing seen yet
- $S_1$: we have seen H
- $S_2$: we have seen HT
- $S_3$: we have seen HTH — absorbing state

The transitions are:

- From $S_0$: T with probability $\frac{1}{2}$ (stay in $S_0$), H with probability $\frac{1}{2}$ (go to $S_1$)
- From $S_1$: H with probability $\frac{1}{2}$ (stay in $S_1$), T with probability $\frac{1}{2}$ (go to $S_2$)
- From $S_2$: T with probability $\frac{1}{2}$ (return to $S_0$), H with probability $\frac{1}{2}$ (go to $S_3$)

**System of equations**

We seek the expected time $\mu_i$ to reach $S_3$ from $S_i$. We have $\mu_3 = 0$. The system is:

$$
\begin{cases}
\mu_0 = 1 + \frac{1}{2} \mu_0 + \frac{1}{2} \mu_1 \\
\mu_1 = 1 + \frac{1}{2} \mu_1 + \frac{1}{2} \mu_2 \\
\mu_2 = 1 + \frac{1}{2} \cdot 0 + \frac{1}{2} \mu_0 = 1 + \frac{1}{2} \mu_0
\end{cases}
$$

**Solution**

From equation 3:

$$
\mu_2 = 1 + \frac{1}{2} \mu_0
$$

Substitute into equation 2:

$$
\mu_1 = 1 + \frac{1}{2} \mu_1 + \frac{1}{2}\left(1 + \frac{1}{2} \mu_0\right) = 1 + \frac{1}{2} \mu_1 + \frac{1}{2} + \frac{1}{4} \mu_0 = \frac{3}{2} + \frac{1}{2} \mu_1 + \frac{1}{4} \mu_0
$$

$$
\mu_1 - \frac{1}{2} \mu_1 = \frac{3}{2} + \frac{1}{4} \mu_0 \Rightarrow \frac{1}{2} \mu_1 = \frac{3}{2} + \frac{1}{4} \mu_0 \Rightarrow \mu_1 = 3 + \frac{1}{2} \mu_0
$$

Substitute into equation 1:

$$
\mu_0 = 1 + \frac{1}{2} \mu_0 + \frac{1}{2}\left(3 + \frac{1}{2} \mu_0\right) = 1 + \frac{1}{2} \mu_0 + \frac{3}{2} + \frac{1}{4} \mu_0 = \frac{5}{2} + \frac{3}{4} \mu_0
$$

$$
\mu_0 - \frac{3}{4} \mu_0 = \frac{5}{2} \Rightarrow \frac{1}{4} \mu_0 = \frac{5}{2} \Rightarrow \mu_0 = 10
$$

**Conclusion**

The expected time for the sequence HTH to appear is:

$$
\boxed{10}
$$
